<!DOCTYPE html>
<html lang="ru">
<head>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <meta charset="UTF-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
  <title>SportGate Tap Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      touch-action: manipulation;
      font-family: sans-serif;
      background-color: #008000;
    }

    #score, #title {
      position: absolute;
      left: 20px;
      z-index: 10;
      color: white;
      text-shadow: 1px 1px 4px black;
      user-select: none;
    }

    #score {
      top: 40px;
      font-size: 24px;
      font-weight: bold;
    }

    #title {
      top: 10px;
      font-size: 20px;
      font-weight: bold;
      color: #ffffff;
    }

    #gameCanvas {
      position: absolute;
      top: 0;
      left: 0;
      display: block;
    }
	
#soundButton {
  position: absolute;
  top: 20px; /* –ü–æ–¥–≤–∏–Ω—É–ª–∏ –≤—ã—à–µ */
  right: 20px;
  z-index: 100;
  padding: 8px 15px;
  background: rgba(255, 255, 255, 0.9);
  border: 2px solid #ffffff;
  border-radius: 25px;
  font-weight: bold;
  color: #008000;
  font-size: 14px;
  cursor: pointer;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
}

#soundButton:hover {
  background: #ffffff;
  transform: scale(1.05);
}
  </style>
</head>
<body>
  <div id="title">Player SportGate.io</div>
  <div id="score">Tokens: 0</div>
  <canvas id="gameCanvas"></canvas>
  <button id="soundButton">Sound</button>

  <script>
    window.onload = () => {
      const tg = window.Telegram.WebApp;
      tg.ready(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
      const user = tg.initDataUnsafe.user;
      if (user) {
        const username = user.username || `${user.first_name} ${user.last_name || ''}`;
        document.getElementById("title").textContent = `Player: ${username}`;
      }
	  
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

// --- HOWLER.JS –ê–£–î–ò–û –°–ò–°–¢–ï–ú–ê –° –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–ï–ú ---
let soundsEnabled = false;
let goalSound, saveSound;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–≤—É–∫–∏ —Å—Ä–∞–∑—É
goalSound = new Howl({
  src: ['goal_sound.mp3'],
  preload: true,
  volume: 0.7,
  html5: true
});

saveSound = new Howl({
  src: ['save_sound.mp3'],
  preload: true, 
  volume: 0.7,
  html5: true
});

Howler.mute(true);

// –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å
const soundButton = document.getElementById('soundButton');
soundButton.textContent = 'üîá Sound';

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞
soundButton.addEventListener('click', () => {
  soundsEnabled = !soundsEnabled;
  
  if (soundsEnabled) {
    Howler.mute(false);
    soundButton.textContent = 'üîä Sound';
  } else {
    Howler.mute(true);
    soundButton.textContent = 'üîá Sound';
  }
});

// –§—É–Ω–∫—Ü–∏–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
function playGoalSound() {
  if (soundsEnabled) {
    goalSound.play();
  }
}

function playSaveSound() {
  if (soundsEnabled) {
    saveSound.play();
  }
}

	  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–∞—á–∞
	  canvas.addEventListener("touchstart", () => {
	    lastTouchTime = Date.now();
	    showIdleCircle = false;
	  });
	  
	  canvas.addEventListener("mousedown", () => {
	    lastTouchTime = Date.now();
	    showIdleCircle = false;
	  });

      let score = 0;
	  let idlePulse = 0;
	  let jumpOffset = 0;
	  let armOffset = 0;
	  let legOffset = 0;
	  let sadTimer = 0
	  let lastTouchTime = Date.now();
	  let showIdleCircle = false;
	  const floatingTexts = [];
	  const fireworks = [];
      const balls = [];
      const goal = {};
      const goalkeeper = {};

      function resizeCanvas() {
        canvas.width = document.documentElement.clientWidth;
        canvas.height = document.documentElement.clientHeight;
		
		const scoreDisplay = document.getElementById("score");
		const scoreRect = scoreDisplay.getBoundingClientRect();
		
		// –í–æ—Ä–æ—Ç–∞
        goal.x = canvas.width / 2 - 200;
        goal.y = scoreRect.bottom + 85; // 85 –ø–∏–∫—Å–µ–ª–µ–π –Ω–∏–∂–µ –æ—á–∫–æ–≤
        goal.width = 400;
        goal.height = 40;
		
        goalkeeper.radius = 18;
        goalkeeper.x = canvas.width / 2 - 15;
        goalkeeper.y = goal.y + goal.height + 10;
        goalkeeper.speedX = 1.5;
        goalkeeper.direction = 1;

		

      }

      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();

	  
function spawnBall(event) {
  // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞–∂–∞—Ç–∏—è
  let clientX, clientY;
  
  if (event.type === 'touchstart') {
    clientX = event.touches[0].clientX;
    clientY = event.touches[0].clientY;
  } else {
    clientX = event.clientX;
    clientY = event.clientY;
  }
  
  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ç–æ—á–∫—É –≤—ã—Å—Ç—Ä–µ–ª–∞ –Ω–∏–∂–Ω–µ–π —á–∞—Å—Ç—å—é —ç–∫—Ä–∞–Ω–∞ (–Ω–∏–∂–µ —Ü–µ–Ω—Ç—Ä–∞)
  const minY = canvas.height * 0.7; // 70% –æ—Ç –≤—ã—Å–æ—Ç—ã —ç–∫—Ä–∞–Ω–∞
  const spawnY = Math.max(clientY, minY);
  
  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ç–æ—á–∫—É –≤—ã—Å—Ç—Ä–µ–ª–∞ —à–∏—Ä–∏–Ω–æ–π –≤–æ—Ä–æ—Ç
  const minX = goal.x + 20; // –Ω–µ–º–Ω–æ–≥–æ –æ—Ç—Å—Ç—É–ø–∞–µ–º –æ—Ç –∫—Ä–∞—è –≤–æ—Ä–æ—Ç
  const maxX = goal.x + goal.width - 20;
  const spawnX = Math.min(Math.max(clientX, minX), maxX);
  
  // –°–æ–∑–¥–∞–µ–º –º—è—á –≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
  balls.push({
    x: spawnX,
    y: spawnY,
    radius: 20,
    speedY: -10,
    angle: 0,
    active: true
  });
}

canvas.addEventListener("click", function(event) {
  event.preventDefault();
  spawnBall(event);
  lastTouchTime = Date.now();
  showIdleCircle = false;
});

canvas.addEventListener("touchstart", function(event) {
  event.preventDefault();
  spawnBall(event);
  lastTouchTime = Date.now();
  showIdleCircle = false;
});

function spawnFloatingText(text, x, y, color = "white") {
  floatingTexts.push({
    text,
    x,
    y,
    alpha: 1,
    dy: -1.2,
    color
  });
}

function updateFloatingTexts() {
  for (let i = floatingTexts.length - 1; i >= 0; i--) {
    const t = floatingTexts[i];
    t.y += t.dy;
    t.alpha -= 0.02;
    if (t.alpha <= 0) {
      floatingTexts.splice(i, 1);
    }
  }
}

function drawFloatingTexts() {
  floatingTexts.forEach(t => {
    ctx.save();
    ctx.font = "bold 36px sans-serif";
    ctx.fillStyle = t.color;
    ctx.globalAlpha = t.alpha;

    // –î–æ–±–∞–≤–∏–º –ª—ë–≥–∫—É—é —Ç–µ–Ω—å
    ctx.shadowColor = "black";
    ctx.shadowBlur = 4;

    ctx.fillText(t.text, t.x, t.y);

    // –°–±—Ä–æ—Å —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    ctx.globalAlpha = 1;
    ctx.shadowBlur = 0;
    ctx.restore();
  });
}

function colorToRGB(color) {
  const tempCanvas = document.createElement("canvas");
  const tempCtx = tempCanvas.getContext("2d");
  tempCtx.fillStyle = color;
  const rgb = tempCtx.fillStyle.match(/\d+/g).slice(0, 3);
  return rgb.join(",");
}

function spawnFirework(x, y) {
  for (let i = 0; i < 40; i++) {
    fireworks.push({
      x: x,
      y: y,
      radius: 2 + Math.random() * 3,
      angle: Math.random() * 2 * Math.PI,
      speed: 2 + Math.random() * 4,
      alpha: 1,
      color: getBrightColor()
    });
  }
}

function getBrightColor() {
  const colors = [
    "rgb(255, 255, 255)", // –±–µ–ª—ã–π
    "rgb(255, 255, 0)",   // –∂—ë–ª—Ç—ã–π
    "rgb(0, 191, 255)",   // –≥–æ–ª—É–±–æ–π
    "rgb(255, 105, 180)", // —Ä–æ–∑–æ–≤—ã–π
    "rgb(0, 255, 0)"      // –∑–µ–ª—ë–Ω—ã–π
  ];
  return colors[Math.floor(Math.random() * colors.length)];
}

function updateFireworks() {
  for (let i = fireworks.length - 1; i >= 0; i--) {
    const p = fireworks[i];
    p.x += Math.cos(p.angle) * p.speed;
    p.y += Math.sin(p.angle) * p.speed;
    p.alpha -= 0.02;
    if (p.alpha <= 0) {
      fireworks.splice(i, 1);
    }
  }
}

function drawFireworks() {
  fireworks.forEach(p => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
    ctx.fillStyle = `${p.color.replace("rgb", "rgba").replace(")", `, ${p.alpha})`)}`;
    ctx.fill();
  });
}

function getRandomPlusColor() {
  const colors = [
    "rgb(255, 255, 255)", // –±–µ–ª—ã–π
    "rgb(255, 255, 0)",   // –∂—ë–ª—Ç—ã–π
    "rgb(0, 191, 255)",   // –≥–æ–ª—É–±–æ–π
    "rgb(144, 238, 144)"  // —Å–∞–ª–∞—Ç–æ–≤—ã–π (light green)
  ];
  return colors[Math.floor(Math.random() * colors.length)];
}

function hslToRgb(hslColor) {
  const tempCanvas = document.createElement("canvas");
  const tempCtx = tempCanvas.getContext("2d");
  tempCtx.fillStyle = hslColor;
  const rgb = tempCtx.fillStyle.match(/\d+/g).slice(0, 3);
  return rgb.join(",");
}

function drawFieldStripes() {
  const stripeCount = 7; // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–æ—Å
  const stripeWidth = canvas.width / stripeCount;
  const colors = ["#228B22", "#6DBE45"]; // –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –∑–µ–ª—ë–Ω—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏

  for (let i = 0; i < stripeCount; i++) {
    ctx.fillStyle = colors[i % 2];
    ctx.fillRect(i * stripeWidth, 0, stripeWidth, canvas.height);
  }
}

function drawGoal() {
  const postWidth = 10;
  const postHeight = goal.height + 40; // –£–¥–ª–∏–Ω–µ–Ω–Ω—ã–µ —Å—Ç–æ–π–∫–∏
  const crossbarHeight = 10;

  // –¶–≤–µ—Ç —Å—Ç–æ–µ–∫ –∏ –ø–µ—Ä–µ–∫–ª–∞–¥–∏–Ω—ã
  ctx.fillStyle = "#FFFFFF";

  // –õ–µ–≤–∞—è —Å—Ç–æ–π–∫–∞ ‚Äî –æ—Ç –ø–µ—Ä–µ–∫–ª–∞–¥–∏–Ω—ã –¥–æ –Ω–∏–∑–∞ –≤–æ—Ä–æ—Ç
  ctx.fillRect(goal.x, goal.y - postHeight, postWidth, postHeight+40);

  // –ü—Ä–∞–≤–∞—è —Å—Ç–æ–π–∫–∞
  ctx.fillRect(goal.x + goal.width - postWidth, goal.y - postHeight, postWidth, postHeight + 40);

  // –ü–µ—Ä–µ–∫–ª–∞–¥–∏–Ω–∞
  ctx.fillRect(goal.x, goal.y - postHeight, goal.width, crossbarHeight);
  
    // –ü–µ—Ä–µ–∫–ª–∞–¥–∏–Ω–∞ –≤—Ç–æ—Ä–∞—è
  ctx.fillRect(goal.x, goal.y, goal.width, crossbarHeight);

  // –°–µ—Ç–∫–∞ –≤–æ—Ä–æ—Ç ‚Äî –æ—Ç –Ω–∏–∂–Ω–µ–π —á–∞—Å—Ç–∏ –¥–æ –ø–µ—Ä–µ–∫–ª–∞–¥–∏–Ω—ã
  ctx.strokeStyle = "rgba(255, 255, 255, 0.3)";
  const gridSize = 8;
  for (let x = goal.x+5; x < goal.x + goal.width - 5; x += gridSize) {
    for (let y = goal.y-5; y > goal.y - postHeight + crossbarHeight; y -= gridSize) {
      ctx.strokeRect(x, y, gridSize, gridSize);
    }
  }

  // –û–±–≤–æ–¥–∫–∞ –≤–æ—Ä–æ—Ç (–Ω–∏–∂–Ω—è—è —á–∞—Å—Ç—å)
  ctx.strokeStyle = "white";
  ctx.lineWidth = 2;
  ctx.strokeRect(goal.x+1, goal.y, goal.width-2, goal.height);
}

function drawGoalkeeper() {
  ctx.save();
  ctx.translate(0, jumpOffset); // –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä—ã–∂–∫–∞
  const skinColor = "#F4C2C2"; // —Å–≤–µ—Ç–ª—ã–π —Ç–µ–ª–µ—Å–Ω—ã–π (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–π –æ—Ç—Ç–µ–Ω–æ–∫)

  // –ú–∞–π–∫–∞ (–≤–µ—Ä—Ö —Ç—É–ª–æ–≤–∏—â–∞)
  ctx.fillStyle = "#A9A9A9"; // —Å–µ—Ä–∞—è
  ctx.fillRect(goalkeeper.x - 10, goalkeeper.y, 20, 25);
  ctx.font = "bold 16px sans-serif";
  ctx.fillStyle = "white";
  ctx.textAlign = "center";
  ctx.fillText("0", goalkeeper.x, goalkeeper.y + 18);
  
  // –®–æ—Ä—Ç—ã
  ctx.fillStyle = "#00BFFF"; // –≥–æ–ª—É–±—ã–µ
  ctx.fillRect(goalkeeper.x - 10, goalkeeper.y + 25, 20, 15);
  
  // –ì–æ–ª–æ–≤–∞
  ctx.beginPath();
  ctx.arc(goalkeeper.x, goalkeeper.y - 10, 12, 0, Math.PI * 2);
  ctx.fillStyle = skinColor;
  ctx.fill();

  // –ì–ª–∞–∑–∞
  ctx.beginPath();
  ctx.arc(goalkeeper.x - 5, goalkeeper.y - 23, 5, 0, Math.PI * 2);
  ctx.fillStyle = "white";
  ctx.fill();
  ctx.beginPath();
  ctx.arc(goalkeeper.x - 5, goalkeeper.y - 23, 1.5, 0, Math.PI * 2);
  ctx.fillStyle = "black";
  ctx.fill();

  ctx.beginPath();
  ctx.arc(goalkeeper.x + 5, goalkeeper.y - 23, 5, 0, Math.PI * 2);
  ctx.fillStyle = "white";
  ctx.fill();
  ctx.beginPath();
  ctx.arc(goalkeeper.x + 5, goalkeeper.y - 23, 1.5, 0, Math.PI * 2);
  ctx.fillStyle = "black";
  ctx.fill();

  // –†—É–∫–∏
  ctx.fillStyle = skinColor;
  ctx.fillRect(goalkeeper.x - 25, goalkeeper.y + 5 + armOffset, 15, 8); // –ª–µ–≤–∞—è
  ctx.fillRect(goalkeeper.x + 10, goalkeeper.y + 5 + armOffset, 15, 8); // –ø—Ä–∞–≤–∞—è

  // –ü–µ—Ä—á–∞—Ç–∫–∏
  ctx.beginPath();
  ctx.arc(goalkeeper.x - 30, goalkeeper.y + 9 + armOffset, 6, 0, Math.PI * 2);
  ctx.fillStyle = "#FFD700";
  ctx.fill();

  ctx.beginPath();
  ctx.arc(goalkeeper.x + 30, goalkeeper.y + 9 + armOffset, 6, 0, Math.PI * 2);
  ctx.fillStyle = "#FFD700";
  ctx.fill();

  // –ù–æ–≥–∏
  ctx.fillStyle = skinColor;
  ctx.fillRect(goalkeeper.x - 8, goalkeeper.y + 40 + legOffset, 6, 10);
  ctx.fillRect(goalkeeper.x + 2, goalkeeper.y + 40 - legOffset, 6, 10);

  // –ë—É—Ç—Å—ã
  ctx.fillStyle = "black";
  ctx.fillRect(goalkeeper.x - 8, goalkeeper.y + 50 + legOffset, 6, 5);
  ctx.fillRect(goalkeeper.x + 2, goalkeeper.y + 50 - legOffset, 6, 5);
  
  // –≠–º–æ—Ü–∏–∏ ‚Äî —Ä–æ—Ç
  if (sadTimer > 0) {
    ctx.beginPath();
    ctx.arc(goalkeeper.x, goalkeeper.y - 5, 6, Math.PI, 2 * Math.PI); // –≥—Ä—É—Å—Ç–Ω—ã–π —Ä–æ—Ç
    ctx.strokeStyle = "black";
    ctx.lineWidth = 2;
    ctx.stroke();
    sadTimer--;
  } else {
    ctx.beginPath();
    ctx.arc(goalkeeper.x, goalkeeper.y - 15, 6, 0, Math.PI); // —É–ª—ã–±–∫–∞
    ctx.strokeStyle = "black";
    ctx.lineWidth = 2;
    ctx.stroke();
  }

  ctx.restore();
}
      function updateGoalkeeper() {
	    const baseSpeed = 2.5;
        goalkeeper.x += goalkeeper.speedX * goalkeeper.direction;
        if ( goalkeeper.x + goalkeeper.radius > goal.x + goal.width ) { 
		  goalkeeper.direction = -1;
		} else if (goalkeeper.x - goalkeeper.radius < goal.x) {
		  goalkeeper.direction = 1;
		} else {
		  const randomDirection = Math.random();
		  if (randomDirection < 0.01) {
		    goalkeeper.direction = -1; // 40% chance –≤–ª–µ–≤–æ
		  } else if (randomDirection > 0.99 ) {
		    goalkeeper.direction = 1; // 40% chance –≤–ø—Ä–∞–≤–æ
		  }
		}
		
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–º–Ω–æ–≥–æ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏
		goalkeeper.speedX = baseSpeed + (Math.random() * 1.5 - 0.75);

		jumpOffset = Math.sin(Date.now() / 200) * 5; // –ø–ª–∞–≤–Ω–æ–µ –ø–æ–¥–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–µ
		armOffset = Math.sin(Date.now() / 300) * 4; // –ø–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö-–≤–Ω–∏–∑
		legOffset = Math.sin(Date.now() / 250) * 3; // –ø–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –Ω–æ–≥
      }

      function drawHexagon(ctx, x, y, size) {
        const offset = Math.PI / 6;
        ctx.beginPath();
        for (let i = 0; i < 6; i++) {
          const angle = offset + i * Math.PI / 3;
          const px = x + size * Math.cos(angle);
          const py = y + size * Math.sin(angle);
          i === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
        }
        ctx.closePath();
        ctx.fill();
      }

      function drawBall(ball) {
        ctx.save();
        ctx.translate(ball.x, ball.y);
        ctx.rotate(ball.angle);
        ctx.beginPath();
        ctx.fillStyle = "white";
        ctx.arc(0, 0, ball.radius, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = "black";
        ctx.stroke();

        ctx.fillStyle = "black";
		
        drawHexagon(ctx, -7, -7, 6);
        drawHexagon(ctx, 8, -5, 6);
        drawHexagon(ctx, 0, 9, 6);

        ctx.restore();
      }

      function updateBalls() {
        for (let i = balls.length - 1; i >= 0; i--) {
          const ball = balls[i];
          if (ball.active) {
            ball.y += ball.speedY;
            ball.angle += 0.1;

            const dx = ball.x - goalkeeper.x;
            const dy = ball.y - goalkeeper.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance < ball.radius + goalkeeper.radius) {
			  playSaveSound();
			  const randX = goal.x + 20 + Math.random() * (goal.width - 40); // –≤–Ω—É—Ç—Ä–∏ —à–∏—Ä–∏–Ω—ã –≤–æ—Ä–æ—Ç
			  const randY = goal.y + goal.height + 30; 
			  spawnFloatingText("X", randX, randY, "#ff4444"); // –∫—Ä–∞—Å–Ω—ã–π
              ball.active = false;
              balls.splice(i, 1);
              continue;
            }

            if (
              ball.y - ball.radius < goal.y + goal.height &&
              ball.x > goal.x &&
              ball.x < goal.x + goal.width
            ) {
			  playGoalSound();
			  spawnFirework(ball.x, goal.y + goal.height / 2);
			  const randX = goal.x + 20 + Math.random() * (goal.width - 40); // –≤–Ω—É—Ç—Ä–∏ –≤–æ—Ä–æ—Ç, —Å –Ω–µ–±–æ–ª—å—à–∏–º –æ—Ç—Å—Ç—É–ø–æ–º
			  const randY = Math.random() * canvas.height * 0.6; // –≤–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å —ç–∫—Ä–∞–Ω–∞
			  spawnFloatingText("+1", randX, randY, getRandomPlusColor());
			  sadTimer = 60; // –≥—Ä—É—Å—Ç–∏—Ç 60 –∫–∞–¥—Ä–æ–≤
              score += 1;
              document.getElementById("score").textContent = "Tokens: " + score;
              ball.active = false;
              balls.splice(i, 1);
            } else if (ball.y + ball.radius < 0) {
              ball.active = false;
              balls.splice(i, 1);
            }
          }
        }
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
		drawFieldStripes();
		drawFloatingTexts();
		updateFloatingTexts();
		drawFireworks();
		updateFireworks();
        drawGoal();
        drawGoalkeeper();
        balls.forEach(drawBall);
        updateBalls();
        updateGoalkeeper();
		
		if (Date.now() - lastTouchTime > 3000) {
		  showIdlePrompt = true;
		} else {
		  showIdlePrompt = false;
		}
		
		idlePulse = Math.sin(Date.now() / 500) * 0.3 + 0.7;
		
		if (showIdlePrompt) {
		  ctx.font = "bold 36px sans-serif";
		  ctx.textAlign = "center";
		  ctx.lineWidth = 2;
		  ctx.globalAlpha = idlePulse;

		  // –û–±–≤–æ–¥–∫–∞
		  ctx.strokeStyle = "white";
		  ctx.strokeText("Tap to shoot", canvas.width / 2, canvas.height / 1.5);

		  // –ó–∞–ª–∏–≤–∫–∞
		  ctx.fillStyle = "white";
		  ctx.fillText("Tap to shoot", canvas.width / 2, canvas.height / 1.5);

		  ctx.globalAlpha = 1;
		}		
        requestAnimationFrame(draw);
      }

      draw();
    };
  </script>
</body>
</html>
